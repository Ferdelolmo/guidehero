{"version":3,"file":"userAction.test.js","sourceRoot":"","sources":["../../../../../../src/api/userActions/userAction.test.ts"],"names":[],"mappings":"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","sourcesContent":["import { jest } from '@jest/globals';\n\nimport { type TransportItem, TransportItemType, Transports } from '../..';\nimport { mockTransports } from '../apiTestHelpers';\nimport { ItemBuffer } from '../ItemBuffer';\n\nimport { UserActionState } from './types';\nimport UserAction from './userAction';\n\njest.useFakeTimers();\njest.mock('../../sdk/registerFaro', () => ({\n  faro: {\n    api: {\n      pushEvent: jest.fn(),\n    },\n  },\n}));\n\ndescribe('UserAction', () => {\n  let transports: Transports;\n\n  beforeEach(() => {\n    transports = mockTransports;\n\n    jest.spyOn(ItemBuffer.prototype, 'flushBuffer').mockImplementation((cb?: (item: TransportItem) => void) => {\n      if (cb) {\n        const dummyItem = { type: TransportItemType.EVENT, payload: {}, meta: {} };\n        cb(dummyItem);\n      }\n    });\n  });\n\n  afterEach(() => {\n    jest.clearAllMocks();\n    jest.clearAllTimers();\n  });\n\n  it('initializes in Started state and sets startTime', () => {\n    const ua = new UserAction({ name: 'foo', transports, trigger: 'foo' });\n    expect(ua.getState()).toBe(UserActionState.Started);\n    expect(typeof ua.startTime).toBe('number');\n    expect(ua.startTime! > 0).toBe(true);\n  });\n\n  it('cancel() flushes the buffer and goes to Cancelled', () => {\n    const ua = new UserAction({ name: 'foo', transports, trigger: 'foo' });\n    ua.cancel();\n\n    expect(ua.getState()).toBe(UserActionState.Cancelled);\n    expect(ItemBuffer.prototype.flushBuffer).toHaveBeenCalled();\n    expect(transports.execute).not.toHaveBeenCalled();\n  });\n\n  it('end() will not fire if action is cancelled', () => {\n    const ua = new UserAction({ name: 'foo', transports, trigger: 'foo' });\n    ua.cancel();\n    ua.end();\n    expect(ua.getState()).toBe(UserActionState.Cancelled);\n  });\n\n  it('end() will send items with action payload', () => {\n    const ua = new UserAction({ name: 'foo', transports, trigger: 'foo' });\n    ua.end();\n    expect(ua.getState()).toBe(UserActionState.Ended);\n    expect(transports.execute).not.toHaveBeenCalledWith('koko');\n  });\n\n  it('addItem returns true and buffers when state is Started', () => {\n    const userAction = new UserAction({ name: 'foo', transports, trigger: 'foo' });\n    const item: TransportItem = { type: TransportItemType.EVENT, payload: {}, meta: {} };\n    const result = userAction.addItem(item);\n    expect(result).toBe(true);\n  });\n\n  it('addItem returns false when state is Halted', () => {\n    const userAction = new UserAction({ name: 'foo', transports, trigger: 'foo' });\n    userAction.halt();\n    const item: TransportItem = { type: TransportItemType.EVENT, payload: {}, meta: {} };\n    const result = userAction.addItem(item);\n    expect(result).toBe(false);\n  });\n\n  it('addItem returns false when state is Cancelled', () => {\n    const userAction = new UserAction({ name: 'foo', transports, trigger: 'foo' });\n    userAction.cancel();\n    const item: TransportItem = { type: TransportItemType.EVENT, payload: {}, meta: {} };\n    const result = userAction.addItem(item);\n    expect(result).toBe(false);\n  });\n\n  it('addItem returns false when state is Ended', () => {\n    const userAction = new UserAction({ name: 'foo', transports, trigger: 'foo' });\n    userAction.end();\n    const item: TransportItem = { type: TransportItemType.EVENT, payload: {}, meta: {} };\n    const result = userAction.addItem(item);\n    expect(result).toBe(false);\n  });\n});\n"]}